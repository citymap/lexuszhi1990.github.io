<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>backbone Summary</title>
  <meta name="description" content="Backbone.js MVC">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/blog/2014/05/11/backbone-summary">
  <link rel="alternate" type="application/rss+xml" title="Tide-Hunter" href="/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Tide-Hunter</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">backbone Summary</h1>
    <p class="post-meta">May 11, 2014</p>
  </header>

  <article class="post-content">
    <h3>Backbone.js MVC</h3>

<p>Backbone.js gives structure to web applications by providing models with key-value
binding and custom events, collections with a rich API of enumerable functions, views
with declarative event handling, and connects it all to your existing API over a RESTful JSON interface.</p>

<p>所以backbone的特点可有由一下几点概况： MVC， EVENTS， RESTFUL。</p>

<ul>
<li>View 的划分将页面上的视图元素解耦，粒度细化。View 间通过事件（EVENT）和 Model 通讯，避免了 DOM 事件的滥用。</li>
<li>Model 和 Restful 的通讯方式对于后端人员非常友好。</li>
<li>MVC 架构清晰。可定制性较高</li>
<li>Collection/Model 抽象了以前杂乱的 AJAX 请求，CRUD 请求变得非常非常方便。</li>
<li>View -&gt; Model 单向依赖</li>
</ul>

<!-- more -->

<p>其实backbone只是对前端MVC概念的一次封装。
Backbone 其实并不是框架，而且 Backbone 特意不愿意把自己做成一个框架。建议用 Marionette 替换列
表上的 Backbone，至少 Marionette 基于 Backbone，且看起来像一个框架。<a href="http://ruby-china.org/topics/14415">lgn21st 的意思</a></p>

<h3>RAILS BACKBONE</h3>

<p>GEM:
目前用得是这个<a href="https://github.com/westonplatter/railsy_backbone">railsy_backbone gem</a></p>

<p>它封装了一些方法,跟rails 的generate 很像。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Backbone</span> <span class="nx">Model</span> <span class="nx">$</span> <span class="nx">rails</span> <span class="nx">g</span> <span class="nx">backbone</span><span class="o">:</span><span class="nx">model</span>
<span class="nx">Backbone</span> <span class="nx">Router</span> <span class="nx">$</span> <span class="nx">rails</span> <span class="nx">g</span> <span class="nx">backbone</span><span class="o">:</span><span class="nx">router</span>
<span class="nx">Backbone</span> <span class="nx">Scaffold</span> <span class="nx">$</span> <span class="nx">rails</span> <span class="nx">g</span> <span class="nx">backbone</span><span class="o">:</span><span class="nx">scaffold</span>
</code></pre></div>
<h3>BACKBOBE <code>Render</code> FUNCTION</h3>

<p>首先我们先说下rails 的MVC框架，<code>controller</code> 中获取数据，<code>model</code>中处理
数据逻辑，<code>view</code>负责渲染html。 其中<code>view</code>的页面逻辑清楚， <code>controller</code>
负责提取数据的调用，数据的逻辑都应该放到<code>model</code>里面去，所以有<strong>fatter model thinner controller</strong>
的说法。也看到过是 <code>controller</code> 里面的代码不应该超过10行的说法。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">#</span> <span class="nx">backbone</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">tasks</span><span class="o">/</span><span class="nx">index_view</span><span class="p">.</span><span class="nx">js</span><span class="p">.</span><span class="nx">coffee</span>

<span class="kr">class</span> <span class="nx">Ezitask</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Tasks</span><span class="p">.</span><span class="nx">IndexView</span> <span class="kr">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span>
  <span class="nx">template</span><span class="o">:</span> <span class="nx">JST</span><span class="p">[</span><span class="s2">&quot;backbone/templates/tasks/index&quot;</span><span class="p">]</span>

  <span class="nx">className</span><span class="o">:</span> <span class="s2">&quot;container task_list&quot;</span>

  <span class="nx">events</span><span class="o">:</span>
    <span class="s2">&quot;click .setting_option&quot;</span> <span class="o">:</span> <span class="s2">&quot;optionView&quot;</span>

  <span class="nx">initialize</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="err">#</span> <span class="nx">your</span> <span class="nx">local</span> <span class="nx">here</span> <span class="nx">before</span> <span class="err">`</span><span class="nx">render</span><span class="p">()</span><span class="err">`</span>
    <span class="err">@</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="err">@</span><span class="nx">addOneTask</span>

  <span class="nx">addAllTasks</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span>
    <span class="err">@</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="err">@</span><span class="nx">addOneTask</span><span class="p">)</span>

  <span class="nx">addOneTask</span><span class="o">:</span> <span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="err">@</span><span class="nx">task_view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ezitask</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Tasks</span><span class="p">.</span><span class="nx">TaskView</span><span class="p">({</span><span class="nx">model</span> <span class="o">:</span> <span class="nx">task</span><span class="p">})</span>
    <span class="err">@</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tasks_content tbody&quot;</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="err">@</span><span class="nx">task_view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">)</span>

  <span class="nx">render</span><span class="o">:</span> <span class="o">=&gt;</span>
    <span class="err">@</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="err">@</span><span class="nx">template</span><span class="p">(</span><span class="err">@</span><span class="nx">collection</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="p">))</span>
    <span class="err">@</span><span class="nx">addAllTasks</span><span class="p">()</span>
    <span class="err">@</span>
</code></pre></div>
<p>这是backbone的典型的一个VIEW，当在router中定义这个view，然后render出来。它在router被实例化，</p>

<p>分析下<code>render</code> 这个方法。
首先 <code>@template(@collection.toJSON() )</code> 的意思就是把template 和 collection 结合起来
渲染成html的String。</p>

<p><code>$elview.$el</code>  的官方解释：
A cached jQuery object for the view&#39;s element. A handy reference instead of re-wrapping
the DOM element all the time.</p>

<p><code>@$el</code> 得到的是这个view的html element。 然后通过JQuery <code>html</code>。
这样el就已经有了html element框架，然后才能执行添加所以task的操作。
<code>@$(&quot;#tasks_content tbody&quot;)</code>  前面的<code>@</code>是保证元素的查找是在当前view,或者说是template里面，
而<code>$(&quot;#tasks_content tbody&quot;)</code>则是普通的JQuery 查找。
然后返回当前这个view。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">#</span> <span class="nx">backbone</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">tasks</span><span class="o">/</span><span class="nx">index_view</span><span class="p">.</span><span class="nx">js</span><span class="p">.</span><span class="nx">coffee</span>

  <span class="nx">index</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">indexView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ezitask</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Tasks</span><span class="p">.</span><span class="nx">IndexView</span><span class="p">(</span><span class="nx">collection</span><span class="o">:</span> <span class="err">@</span><span class="nx">tasks</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tasks_page&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="err">@</span><span class="nx">indexView</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">)</span>
</code></pre></div>
<p>这是Router里面 <code>index action</code> 的方法，就是new一个 <code>IndexView</code>, 传进 <code>collection</code>,
<code>@indexView.render()</code> 这个方法会渲染好这个 <code>view</code> 的数据。</p>

<p><code>$(&quot;#tasks_page&quot;).html(@indexView.render().el)</code> 就是直接获取已经渲染好了得View的el，然后
直接html出来。</p>

<p><code>View.el</code> 的官方解释：
All views have a DOM element at all times (the el property), whether they&#39;ve already been inserted into the page or not. In this fashion, views can be rendered at any time, and inserted into the DOM all at once, in order to get high-performance UI rendering with as few reflows and repaints as possible. this.el is created from the view&#39;s <code>tagName</code>, <code>className</code>, <code>id</code> and <code>attributes</code> properties, if specified. If not, el is an empty <code>div</code>.</p>

<h3>USE GRAPE FOR RESTFUL API</h3>

<p>grape guide: https://github.com/intridea/grape
grape-entity: https://github.com/intridea/grape-entity</p>

<p>EXAMPLE MODEL:</p>

<p>```js task.js</p>

<h1>backbone/models/tasks/task.js.coffee</h1>

<p>class Ezitask.Models.Task extends Backbone.Model
  paramRoot: &#39;task&#39;</p>

<p>initialize: -&gt;
    @tracks= new Ezitask.Collections.TracksCollection(task: @)</p>

<p>defaults:
    name: null
    description: null
    start<em>at: null
    end</em>at: null</p>

<p>class Ezitask.Collections.TasksCollection extends Backbone.Collection
  model: Ezitask.Models.Task
  url: &#39;/api/v1/tasks&#39;
```</p>

<p>collection = new Ezitask.Collections.TasksCollection
collection.fetch() # 通过api 抓取task</p>

<p><code>Backbone.Collection</code> 跟数据相关的 api 有 <code>add</code>, <code>reset</code>, <code>remove</code> 等。</p>

<h3>EXTEND FUNTIONS FOR BACKBONE</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">#</span> <span class="nx">backbone</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">_shared</span><span class="o">/</span><span class="nx">calidation</span><span class="p">.</span><span class="nx">js</span>
<span class="nx">Ezitask</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Shared</span><span class="p">.</span><span class="nx">Validation</span> <span class="o">=</span>
  <span class="nx">showValidationErrors</span><span class="o">:</span> <span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">#</span> <span class="nx">your</span> <span class="nx">logic</span> <span class="nx">code</span> <span class="nx">here</span>

<span class="err">#</span> <span class="nx">backbone</span><span class="o">/</span><span class="nx">views</span><span class="o">/</span><span class="nx">_shared</span><span class="o">/</span><span class="nx">private_resource_rategories</span><span class="p">.</span><span class="nx">js</span>
<span class="kr">class</span> <span class="nx">Ezitask</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">PrivateResourceCategories</span><span class="p">.</span><span class="nx">NewView</span> <span class="kr">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span>
  <span class="err">#</span> <span class="nx">mixin</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="err">@</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Ezitask</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Shared</span><span class="p">.</span><span class="nx">Validation</span><span class="p">)</span>
</code></pre></div>
<p>当我们想要统一全站 view 的 validation 的时候，可以用 <strong>_.extend()</strong> 这种方法。
<a href="http://hi.baidu.com/rainchen/item/a5111d01d4c58fc32e4c6b97">more infos here...</a></p>

<h3>useful tips</h3>

<ul>
<li>backbone 的 model 功能应该和 rails 里面的 model 保持一致。</li>
<li>个人建议 <code>url</code> 这个属性放在 <code>collection</code> 上面。 <code>model</code> 的创建用 <code>collection</code> 的create方法
这样能触发 <code>add</code> 事件。 <code>model</code> 的保存用 <code>save</code> 即可。</li>
<li>使用 grape 的 Entity 方法暴露 model，不用 methods 这个方法。 e.g.</li>
</ul>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">#</span> <span class="nx">good</span> <span class="nx">example</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ezitask</span><span class="p">.</span><span class="nx">Routers</span><span class="p">.</span><span class="nx">TasksRouter</span><span class="p">({</span>
  <span class="nx">tasks</span><span class="o">:</span> <span class="o">&lt;%=</span> <span class="nx">raw</span> <span class="nx">Entities</span><span class="o">::</span><span class="nx">Task</span><span class="p">.</span><span class="nx">represent</span><span class="p">(</span><span class="err">@</span><span class="nx">tasks</span><span class="p">).</span><span class="nx">to_json</span> <span class="o">-%&gt;</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">#</span> <span class="nx">bad</span> <span class="nx">example</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ezitask</span><span class="p">.</span><span class="nx">Routers</span><span class="p">.</span><span class="nx">ProductServicesRouter</span><span class="p">({</span>
  <span class="nx">product_services</span><span class="o">:</span> <span class="o">&lt;%=</span> <span class="err">@</span><span class="nx">product_services</span><span class="p">.</span><span class="nx">to_json</span><span class="p">(</span><span class="o">:</span><span class="nx">methods</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">:</span><span class="nx">resource_category</span><span class="p">,</span> <span class="o">:</span><span class="nx">medium_icon_url</span><span class="p">,</span> <span class="o">:</span><span class="nx">private_list</span><span class="p">]).</span><span class="nx">html_safe</span> <span class="o">-%&gt;</span>
<span class="p">});</span>
</code></pre></div>
<h3>referenecs</h3>

<ul>
<li><a href="http://www.csdn.net/article/2013-04-25/2815032-a-comparison-of-angular-backbone-canjs-and-ember">a-comparison-of-angular-backbone-canjs-and-ember</a></li>
</ul>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Tide-Hunter</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Tide-Hunter</li>
          <li><a href="mailto:lexuszhi1990@gmail.com">lexuszhi1990@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/lexuszhi1990">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">lexuszhi1990</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">blog</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
